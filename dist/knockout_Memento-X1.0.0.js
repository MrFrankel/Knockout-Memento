/*! knockout_Memento 2014-01-07 */
ko.msf=function(){var a=[],b=function(){return a},c=function(){a.forEach(function(a){a.clearForGc()}),a.length=0},d=function(b){var c=new ko.msf.mStack(b);return a.push(c),c},e=function(b){var c=a.indexOf(b);return-1==c?!1:(b.clearForGc(),a.splice(c,1),!0)},f=function(){return a.length>0?a[0]:d()};return{getMStacks:b,killMStack:e,purgeMStacks:c,getDefaultStack:f,createNewMStack:d}}(),ko.msf.mStack=function(a){a=a||{},a={stackLimit:a.stackLimit||50,discardUndefined:a.discardUndefined||!1};var b=ko.msf.ErrorHandler,c=!0,d=[],e=[],f=[],g=[],h=0,i=!1,j=function(b,c){b.length>a.stackLimit&&b.shift(),b.push(c.splice(0)),c.length=0},k=function(a,b){var c=a.pop();if(!c)return!1;var e=[];return c.forEach(function(a){e.push(a.duplicate()),i=!0,a.trigger(d),i=!1}.bind(this)),b.push(e.splice(0)),e.length=0,!0},l=function(){e.length=0,f.length=0};this.clearForGc=function(){d.length=0,e.length=0,f.length=0,g.length=0;for(var a in this)this.hasOwnProperty(a)&&(this[a]=void 0);return!0},this.reInit=function(){l(),g.length=0,i=!1,h=!1},this.isUpdating=function(){return i},this.stopListening=function(){c=!1},this.resumeListening=function(){c=!0},this.subscribeTo=function(a){if(!a instanceof Function)return b.throwError("Subscriber is not an instance of Function"),!1;d.push(a);var c={};return c.dispose=function(){var b=d.indexOf(a);d.splice(b,1)},c},this.stackChange=function(d,k,l){if(i||!c)return!1;if(!k)return b.throwError("No subject has been passed to register on"),!1;if(a.discardUndefined&&void 0===l)return!1;f.length=0;var m=new ko.msf.mStack.Memento(d,k,l);return g.push(m),h>0?!0:(j(e,g),!0)},this.triggerUndo=function(){return k(e,f)},this.triggerRedo=function(){return k(f,e)},this.startSequencing=function(){h+=1},this.stopSequencing=function(){h-=1,0>h&&(h=0,b.throwError("Sequencing Mode has been stooped but but never started, ignored")),h>0||j(e,g.reverse())}},ko.extenders.registerToMS=function(a,b){b=b||{};var c=b.stack||ko.msf.getDefaultStack(),d=ko.computed({read:function(){return a()},write:function(b){d.dontReg||d.registerCurrentValue(),a(b)}});return d.dontReg=!1,d.stopRegistering=function(){d.dontReg=!0},d.resumeRegistering=function(){d.dontReg=!1},d.registerCurrentValue=function(){d.registerAValue(a())},d.registerAValue=function(a){c.stackChange(b.context,d,a)},d.valueHasMutated=function(){d.notifySubscribers(a)},d},ko.registerdObservable=function(a,b){var c=ko.observable(a);b=b||{};var d=b.stack||ko.msf.getDefaultStack(),e=ko.computed({read:function(){return c()},write:function(a){e.dontReg||e.registerCurrentValue(),c(a)}});return e.stopRegistering=function(){e.dontReg=!0},e.resumeRegistering=function(){e.dontReg=!1},e.registerCurrentValue=function(){e.registerAValue(c())},e.registerAValue=function(a){d.stackChange(b.context,e,a)},e.valueHasMutated=function(){e.notifySubscribers(c)},e},ko.msf.mStack.Memento=function(a,b,c){var d=a||function(){},e=function(a){a instanceof Array&&a.forEach(function(a){a({context:d,subject:b,value:c})})};this.trigger=function(a){return e(a),b(c),this.clearForGc()},this.duplicate=function(){return new ko.msf.mStack.Memento(d,b,b())},this.clearForGc=function(){b=void 0,c=void 0,d=void 0;for(var a in this)this.hasOwnProperty(a)&&(this[a]=void 0);return!0}},ko.msf.ErrorHandler=function(){var a=function(a){var b=new Error;throw b.message="ko.Memento Error: "+a,b};return{throwError:a}}();