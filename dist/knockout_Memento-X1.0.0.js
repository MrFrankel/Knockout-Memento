/*! knockout_Memento 2014-01-02 */
ko.MCT=function(){var a=[],b=function(){return a},c=function(){a.forEach(function(a){a.clearForGc()}),a.length=0},d=function(b,c){b=b||{},b.errHandler=ko.MCT.ErrorHandler;var d=new ko.MCT.MStack(b,c);return a.push(d),d},e=function(b){var c=a.indexOf(b);return-1==c?!1:(b.clearForGc(),a.splice(c,1),void 0)},f=function(){return a.length>0?a[0]:d()};return{getMStacks:b,killMStack:e,purgeMStacks:c,getDefaultStack:f,createNewMStack:d}}(),ko.MCT.MStack=function(a,b){b=b||{},b={stackLimit:b.stackLimit||50,discardeUndefined:b.discardeUndefined||!1};var c=a.errHandler,d=!0,e=[],f=[],g=[],h=0,i=!1,j=function(a,c){a.length>b.stackLimit&&a.shift(),a.push(c.splice(0)),c.length=0},k=function(a,b){var c=a.pop();if(!c)return!1;var d=[];return c.forEach(function(a){d.push(a.duplicate()),i=!0,a.trigger(),i=!1}.bind(this)),b.push(d.splice(0)),d.length=0,!0},l=function(){e.length=0,f.length=0};this.clearForGc=function(){for(var a in this)this.hasOwnProperty(a)&&(this[a]=void 0);return!0},this.reInit=function(){l(),g.length=0,i=!1,h=!1},this.isUpdating=function(){return i},this.stopListening=function(){d=!1},this.resumeListening=function(){d=!0},this.stackChange=function(a,k,l){if(i||!d)return!1;if(!k)return c.throwError("No subject has been passed to register on"),!1;if(b.discardeUndefined&&void 0===l)return!1;f.length=0;var m=new ko.MCT.MStack.Memento(a,k,l);return g.push(m),h>0?!0:(j(e,g),!0)},this.triggerUndo=function(){return k(e,f)},this.triggerRedo=function(){return k(f,e)},this.startSequencing=function(){h+=1},this.stopSequencing=function(){h-=1,0>h&&(h=0,c.throwError("Sequencing Mode has been stooped but but never started, ignored")),h>0||j(e,g.reverse())}},ko.extenders.registerToSM=function(a,b){b=b||{};var c=b.stack||ko.StateManager.getDefaultStack(),d=ko.computed({read:function(){return a()},write:function(b){d.dontReg||d.registerCurrentValue(),a(b)}});return d.dontReg=!1,d.stopRegistering=function(){d.dontReg=!0},d.resumeRegistering=function(){d.dontReg=!1},d.registerCurrentValue=function(){d.registerAValue(a())},d.registerAValue=function(a){c.stackChange(b.contex,d,a)},d.valueHasMutated=function(){d.notifySubscribers(_actualValue)},d},ko.registerdObservable=function(a,b,c){var d=ko.observable(a),e=ko.computed({read:function(){return d()},write:function(a){e.dontReg||e.registerCurrentValue(),d(a)}});return e.dontReg=!1,e.stopRegistering=function(){e.dontReg=!0},e.resumeRegistering=function(){e.dontReg=!1},e.registerCurrentValue=function(){e.registerAValue(d())},e.registerAValue=function(a){c.stackChange(b,e,a)},e.valueHasMutated=function(){e.notifySubscribers(d)},e},ko.MCT.MStack.Memento=function(a,b,c){var d=b||function(){},e=void 0!==c?c:"";this.trigger=function(){return d(e),this.clearForGc()},this.duplicate=function(){var b=new ko.MCT.MStack.Memento(a,d,d());return b},this.clearForGc=function(){d=void 0,e=void 0,a=void 0;for(var b in this)this.hasOwnProperty(b)&&(this[b]=void 0);return!0}},ko.MCT.ErrorHandler=function(){var a=function(a){var b=new Error;throw b.message="ko.MCT Error: "+a,b};return{throwError:a}}();